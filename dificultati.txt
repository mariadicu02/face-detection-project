
ğŸ§© DocumentaÈ›ie depanare completÄƒ â€“ Moodle pe Raspberry Pi + Sistem prezenÈ›Äƒ facialÄƒ
------------------------------------------------------------------------------------

ğŸ“Œ ProblemÄƒ: Moodle nu se Ã®ncarcÄƒ local (timeout la http://localhost/moodle)

ğŸ” Simptome:
- Pagina rÄƒmÃ¢nea blocatÄƒ Ã®n browser.
- Eroare: ERR_CONNECTION_TIMED_OUT
- Accesul la http://localhost funcÈ›iona, dar nu È™i http://localhost/moodle.

ğŸ§ª Cauze:
1. Moodle fusese configurat anterior pe altÄƒ reÈ›ea.
2. FiÈ™ierul config.php conÈ›inea o adresÄƒ IP veche È™i invalidÄƒ.
3. Apache funcÈ›iona, dar redirectul spre IP-ul anterior bloca accesul.

âœ… SoluÈ›ie:
1. Verificare IP curent:
   ip a
   â†’ Ex: 192.168.0.101

2. Verificare Apache:
   sudo systemctl status apache2

3. Verificare structurÄƒ fiÈ™iere:
   ls /var/www/html/

4. Editare config.php:
   sudo nano /var/www/html/moodle/config.php
   Linia modificatÄƒ:
   $CFG->wwwroot = 'http://localhost/moodle';

5. Salvare È™i reÃ®ncÄƒrcare â†’ Moodle a funcÈ›ionat corect.

ğŸ” Integrare REST API Moodle â€“ Probleme È™i depanare

1ï¸âƒ£ ProblemÄƒ: HTTP 403 Forbidden
Simptome:
- Mesaj Ã®n script: [âŒ] Eroare HTTP: 403
- Ãn browser: Access denied

CauzÄƒ:
- Protocolul REST nu era activat Ã®n Moodle.

SoluÈ›ie:
- Navigare:
  Site administration > Plugins > Web services > Manage protocols
- Bifare REST â†’ Save changes

2ï¸âƒ£ ProblemÄƒ: Token valid, dar serviciu fÄƒrÄƒ permisiuni
Simptome:
- Scriptul returna eroarea:
  "Expecting value: line 1 column 1 (char 0)"

Diagnostic:
- Tokenul era asociat unui serviciu care nu avea funcÈ›iile necesare.

SoluÈ›ie:
- Navigare:
  Site administration > Server > Web services > External services
- Selectare serviciu (ex: AttendanceService)
- AdÄƒugare manualÄƒ funcÈ›ii:
  - core_webservice_get_site_info
  - mod_attendance_get_sessions
  - mod_attendance_update_user_status

3ï¸âƒ£ ProblemÄƒ: FuncÈ›iile nu apÄƒreau Ã®n rÄƒspunsul JSON
CauzÄƒ:
- FuncÈ›iile REST nu erau Ã®ncÄƒ adÄƒugate serviciului tokenului.

SoluÈ›ie:
- External services > AttendanceService > Add functions
- AdÄƒugare funcÈ›ii lipsÄƒ (ex: mod_attendance_get_user_statuses)

ğŸ§  ProblemÄƒ nouÄƒ: Eroare Ã®n marcarea prezenÈ›ei â€“ invalidparameter

Context:
- Scriptul facial_detection.py recunoaÈ™te corect faÈ›a â†’ obÈ›ine ID-ul studentului È™i al sesiunii.
- Ãn pasul final, marcarea prezenÈ›ei eÈ™ueazÄƒ cu mesajul:
  "Invalid parameter value detected (Missing required key in single structure: studentid)"

Diagnostic:
- Moodle aÈ™teaptÄƒ parametrii Ã®ntr-o structurÄƒ de tip dicÈ›ionar, nu forma updates[0][studentid].

SoluÈ›ie:
- Ãnlocuire cod:
  updates[0][studentid] â†’ updates: [{"studentid": ..., "statusid": ...}]
- Trimitere JSON cu:
  headers={'Content-Type': 'application/json'}, json=data

âš ï¸ Alte probleme tehnice observate

ğŸ¥ Eroare camerÄƒ OpenCV/GStreamer:
- WARN: Could not read from resource.

CauzÄƒ:
- CamerÄƒ neconectatÄƒ sau port GStreamer nefuncÈ›ional.

SoluÈ›ii:
- Confirmare camerÄƒ conectatÄƒ.
- Ãnlocuire cu cv2.VideoCapture(0)

ğŸ“· Calitatea imaginilor pentru recunoaÈ™tere:
Probleme:
- Poze neclare â†’ nerecunoscute

SoluÈ›ii:
- Fotografii frontale, nume format prenume_nume.jpg
- StructurÄƒ studenti.json corectÄƒ

âœ… Rezumat funcÈ›ionare sistem

| ComponentÄƒ         | Status        | ObservaÈ›ii                            |
|--------------------|---------------|----------------------------------------|
| Moodle Local       | âœ… FuncÈ›ional | AdresÄƒ stabilitÄƒ pe localhost          |
| REST API           | âœ… Activat     | FuncÈ›ii complet adÄƒugate              |
| Token              | âœ… Valid       | Asociat AttendanceService             |
| Facial Recognition | âœ… FuncÈ›ional | Poze optimizate, encodings salvate    |
| Marcarea prezenÈ›ei | âœ… OK          | DupÄƒ corectare structurÄƒ JSON         |

ğŸ“¦ RecomandÄƒri mentenanÈ›Äƒ:
- VerificÄƒ config.php la schimbare de reÈ›ea.
- ConfirmÄƒ funcÈ›iile asociate tokenului.
- RuleazÄƒ script test:
  python test_moodle_connection.py
- Pentru loguri:
  tail -f /var/log/apache2/error.log
