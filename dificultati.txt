
Documentatie depanare Moodle local pe Raspberry Pi

üîç ProblemƒÉ √Ænt√¢lnitƒÉ:
La accesarea platformei Moodle de pe Raspberry Pi, √Æn browserul local (http://localhost/moodle), pagina rƒÉm√¢nea blocatƒÉ la √ÆncƒÉrcare, fƒÉrƒÉ rƒÉspuns (timeout). Eroarea afi»ôatƒÉ anterior era:
This site can‚Äôt be reached ‚Äì 192.168.X.X took too long to respond.
ERR_CONNECTION_TIMED_OUT

üìå Cauze identificate:
1. Moodle fusese configurat anterior √Æntr-o altƒÉ re»õea Wi-Fi.
2. Fi»ôierul config.php con»õinea o adresƒÉ IP veche, care nu mai era valabilƒÉ √Æn re»õeaua curentƒÉ.
3. Apache era activ, dar Moodle nu se √ÆncƒÉrca din cauza acelui redirect invalid.

‚úÖ Solu»õii aplicate pas cu pas:

1. Verificare re»õea »ôi IP curent Raspberry Pi:
   ip a
   ‚Üí IP activ pe wlan0 a fost 192.168.0.101

2. Verificare func»õionare Apache:
   sudo systemctl status apache2
   ‚Üí Apache era activ.

3. Verificare fi»ôiere site:
   ls /var/www/html/
   ‚Üí Exista folderul moodle, deci Moodle era instalat.

4. Testare localƒÉ √Æn browser:
   - http://localhost ‚Üí pagina Apache OK
   - http://localhost/moodle ‚Üí se bloca, fƒÉrƒÉ √ÆncƒÉrcare

5. Verificare prezen»õƒÉ fi»ôier config.php:
   ls /var/www/html/moodle/config.php

6. Editare fi»ôier config.php pentru a corecta adresa de server:
   sudo nano /var/www/html/moodle/config.php
   ‚Üí Linia modificatƒÉ:
   $CFG->wwwroot = 'http://localhost/moodle';

7. Salvare »ôi re√ÆncƒÉrcare √Æn browser:
   - DupƒÉ modificare, http://localhost/moodle a √Ænceput sƒÉ func»õioneze corect.

üì¶ Concluzii:
- Moodle func»õioneazƒÉ corect pe Raspberry Pi, at√¢t timp c√¢t config.php con»õine o adresƒÉ validƒÉ pentru server.
- La schimbarea re»õelei, este necesarƒÉ actualizarea $CFG->wwwroot din config.php dacƒÉ adresa IP se modificƒÉ.
- Alternativ, se poate folosi http://localhost/moodle pentru acces local, fƒÉrƒÉ grija modificƒÉrii IP-ului.


Documenta»õie tehnicƒÉ ‚Äî Sistem automat de prezen»õƒÉ facialƒÉ cu Moodle
‚úÖ Func»õionalitate generalƒÉ
Acest script:

DetecteazƒÉ fe»õele studen»õilor √Æn timp real prin camerƒÉ.

Recunoa»ôte studentul pe baza imaginilor din poze/.

MarcheazƒÉ prezen»õa √Æn sesiunea activƒÉ din Moodle prin API REST.

üì¶ Cerin»õe
Python 3.x

OpenCV, dlib, requests, numpy

Fi»ôiere .dat pentru recunoa»ôtere facialƒÉ

Fi»ôier studenti.json cu structura: { "NumeStudent": { "id": MOODLE_ID, ... } }

üîê Integrare cu Moodle
Web services activate √Æn Moodle

Pluginul Attendance instalat

Token activ pentru un user cu rol profesor

üì≤ API Moodle folosit
core_course_get_contents ‚Äì pentru a gƒÉsi activitatea de tip Attendance

mod_attendance_get_sessions ‚Äì pentru a gƒÉsi sesiunea activƒÉ

mod_attendance_get_user_statuses ‚Äì pentru a ob»õine statusul ‚ÄûP‚Äù (Prezent)

mod_attendance_update_user_status ‚Äì pentru a marca prezen»õa studentului

‚ö†Ô∏è Probleme √Ænt√¢lnite
Token-ul trebuie generat cu permisiuni suficiente.

Serverul local trebuie accesibil la adresa din MOODLE_URL.

Fe»õele din poze/ trebuie sƒÉ fie clare »ôi bine aliniate.



===============================
DOCUMENTA»öIE ERORI MOODLE
===============================

Scop:
-----
Documentarea completƒÉ a problemelor √Ænt√¢mpinate √Æn integrarea sistemului de recunoa»ôtere facialƒÉ cu Moodle,
precum »ôi solu»õiile aplicate pentru rezolvarea acestora. Informa»õiile de mai jos sunt esen»õiale pentru
mentenan»õa viitoare »ôi √Æn»õelegerea modului de func»õionare al sistemului.

1. PROBLEMA: Eroare 403 - Forbidden
-----------------------------------
Simptome:
- La rularea scriptului `test_moodle_connection.py` apƒÉrea mesajul:
  "[‚ùå] Eroare HTTP: 403"
- √én browser: "Access to 192.168.0.101 was denied. You don't have authorisation to view this page."

Investiga»õii:
- Verificare configurare token √Æn Moodle (Site administration > Server > Web services > Manage tokens)
- Confirmare cƒÉ token-ul era valid, asociat unui utilizator administrator, »ôi nu avea restric»õii IP.
- Testarea directƒÉ a URL-ului √Æn browser a returnat mesajul de interdic»õie de acces.

Diagnostic final:
- Moodle avea web services activate, DAR protocolul REST nu era activat.

Solu»õie:
1. Autentificare ca administrator √Æn Moodle.
2. Navigare la: Site administration > Plugins > Web services > Manage protocols
3. Activare protocol REST (bifarea casetei corespunzƒÉtoare).

Rezultat:
- DupƒÉ aceastƒÉ ac»õiune, URL-ul testat √Æn browser a √Ænceput sƒÉ returneze un JSON valid cu informa»õii despre site.

---

2. PROBLEMA: Token valid dar fƒÉrƒÉ acces la web service
-------------------------------------------------------
Simptome:
- Scriptul de autentificare returna erori de tip:
  "[ERROR] Moodle request failed: Expecting value: line 1 column 1 (char 0)"
- √én logul Apache apƒÉrea eroarea:
  "The server died because the web services or the REST protocol are not enable"

Diagnostic:
- De»ôi token-ul era valid, func»õiile web service nu erau active √Æn serviciul asociat token-ului.

Solu»õie:
1. Verificare √Æn: Site administration > Server > Web services > External services
2. Selectare serviciu asociat token-ului (ex: AttendanceService)
3. Verificare »ôi adƒÉugare func»õii necesare (ex: core_webservice_get_site_info, mod_attendance_*)

---

3. PROBLEMA: Func»õiile nu apƒÉreau √Æn rƒÉspunsul de test
------------------------------------------------------
Simptome:
- Func»õiile precum `mod_attendance_get_sessions` sau `mod_attendance_update_user_status` nu erau disponibile.

Solu»õie:
1. Navigare √Æn Moodle la:
   Site administration > Server > Web services > External services > [AttendanceService]
2. ApƒÉsare pe ‚ÄúAdd functions‚Äù »ôi adƒÉugare manualƒÉ a func»õiilor necesare.

Verificare:
- Rulare din nou a `test_moodle_connection.py`
- Confirmare primire rƒÉspuns JSON valid cu lista completƒÉ a func»õiilor incluse.

---

Concluzie:
----------
Toate problemele √Ænt√¢mpinate au fost legate de configurarea incompletƒÉ a serviciului REST √Æn Moodle.
Diagnosticul a fost posibil prin combinarea:
- TestƒÉrii URL-urilor direct √Æn browser.
- ConsultƒÉrii logurilor Apache (`/var/log/apache2/error.log`)
- VerificƒÉrii setƒÉrilor din interfa»õa de administrare Moodle.
- CreƒÉrii unui script de test dedicat (`test_moodle_connection.py`) pentru confirmarea rƒÉspunsurilor serverului.

DupƒÉ activarea corectƒÉ a protocolului REST, configurarea serviciului web »ôi adƒÉugarea func»õiilor necesare,
comunicarea √Æntre sistemul local (Raspberry Pi) »ôi Moodle a func»õionat corect.



raspi@raspberrypi:~/face-detection-project $ python facial_detection.py 
[INFO] Initializing...
[INFO] Loading images from 'poze/'...
[INFO] Loaded daniel_radu.
[INFO] Loaded rares_oprea.
[INFO] Loaded cosmin_dumitru.
[INFO] Loaded maria_stoica.
[INFO] Loaded ion_ilie.
[INFO] Loaded roxana_ionescu.
[INFO] Loaded elena_matei.
[INFO] Loaded alina_muresan.
[INFO] Loaded bogdan_toma.
[INFO] Loaded ioana_ciobanu.
[INFO] Loaded george_marin.
[INFO] Loaded vlad_neagu.
[INFO] Loaded andrei_popa.
[INFO] Loaded adina_dragomir.
[INFO] Loaded simona_vlad.
[ WARN:0@11.632] global ./modules/videoio/src/cap_gstreamer.cpp (2401) handleMessage OpenCV | GStreamer warning: Embedded video playback halted; module source reported: Could not read from resource.
[ WARN:0@11.633] global ./modules/videoio/src/cap_gstreamer.cpp (1356) open OpenCV | GStreamer warning: unable to start pipeline
[ WARN:0@11.633] global ./modules/videoio/src/cap_gstreamer.cpp (862) isPipelinePlaying OpenCV | GStreamer warning: GStreamer: pipeline have not been created
[INFO] Camera started.
[RECOGNIZED ‚úÖ] simona_vlad (ID: 1014)
[DEBUG] URL: http://192.168.0.101/moodle/webservice/rest/server.php?wstoken=5a987e634310317873b8831b2faeaded&moodlewsrestformat=json&wsfunction=core_course_get_contents
[DEBUG] Params: {'courseid': 2}
[DEBUG] Status Code: 200
[DEBUG] URL: http://192.168.0.101/moodle/webservice/rest/server.php?wstoken=5a987e634310317873b8831b2faeaded&moodlewsrestformat=json&wsfunction=mod_attendance_get_sessions
[DEBUG] Params: {'attendanceid': 1}
[DEBUG] Status Code: 200
[DEBUG] Attendance ID: 1
[DEBUG] Session ID: 4
[DEBUG] URL: http://192.168.0.101/moodle/webservice/rest/server.php?wstoken=5a987e634310317873b8831b2faeaded&moodlewsrestformat=json&wsfunction=mod_attendance_get_session
[DEBUG] Params: {'sessionid': 4}
[DEBUG] Status Code: 200
[DEBUG] Status ID: 5
libpng warning: iCCP: known incorrect sRGB profile
libpng warning: iCCP: known incorrect sRGB profile
libpng warning: iCCP: known incorrect sRGB profile
libpng warning: iCCP: known incorrect sRGB profile
libpng warning: iCCP: known incorrect sRGB profile
[DEBUG] URL: http://192.168.0.101/moodle/webservice/rest/server.php?wstoken=5a987e634310317873b8831b2faeaded&moodlewsrestformat=json&wsfunction=mod_attendance_update_user_status
[DEBUG] Params: {'sessionid': 4, 'updates[0][studentid]': 1014, 'updates[0][statusid]': 5}
[DEBUG] Status Code: 200
[MOODLE ‚úÖ] Marked simona_vlad present. Response: {'exception': 'core\\exception\\invalid_parameter_exception', 'errorcode': 'invalidparameter', 'message': 'Invalid parameter value detected (Missing required key in single structure: studentid)', 'debuginfo': 'Missing required key in single structure: studentid'}


